{% extends "base.html" %}
{% block content %}

<div class="d-flex justify-content-between align-items-center mb-3">
  <div>
    <h2 class="mb-0">{{ patient.full_name }}</h2>
    <div class="text-muted">
      MRN: {{ patient.mrn }}
      {% if patient.date_of_birth %}
        • DOB: {{ patient.date_of_birth }}
      {% endif %}
    </div>
  </div>

  <div class="d-flex gap-2">
    {% if perms.patients.add_encounter %}
      <a class="btn btn-primary"
         href="{% url 'patients:encounter_create' %}?patient={{ patient.id }}">
        New encounter
      </a>
    {% endif %}

    {% if perms.patients.delete_patient %}
      <a class="btn btn-outline-danger"
         href="{% url 'patients:patient_delete' patient.id %}">
        Delete patient
      </a>
    {% endif %}
  </div>
</div>

<hr>

<h4>Encounters</h4>

<div class="card shadow-sm">
  <div class="card-body">
    <div class="table-responsive">
      <table class="table table-hover align-middle mb-0">
        <thead class="table-light">
          <tr>
            <th>ID</th>
            <th>Admitted</th>
            <th>Unit</th>
            <th>Status</th>
            <th class="text-end"></th>
          </tr>
        </thead>
        <tbody>
          {% for enc in encounters %}
            <tr>
              <td>#{{ enc.id }}</td>
              <td>{{ enc.admitted_at|date:"M d, Y H:i" }}</td>
              <td>{{ enc.unit|default:"—" }}</td>
              <td>{{ enc.status|default:"—" }}</td>
              <td class="text-end">
                <a class="btn btn-sm btn-outline-secondary"
                   href="{% url 'patients:encounter_detail' enc.id %}">
                  Open
                </a>
              </td>
            </tr>
          {% empty %}
            <tr>
              <td colspan="5" class="text-muted text-center">No encounters yet.</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>

{% endblock %}
